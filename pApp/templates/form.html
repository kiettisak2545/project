{% extends "navbar.html" %}
{% load static %}
{% block content %}
<form method="POST" id="order-form">
    {% csrf_token %}
    <!-- ฟอร์มข้อมูล -->
    <div class="row" style="width: 30rem;">
        <div class="col">
            <label for="name">ชื่อ</label>
            <input type="text" name="name" id="name" class="form-control" required>

            <label for="address">ที่อยู่</label>
            <input type="text" name="address" id="address" class="form-control" required>
        </div>

        <div class="col">
            <label for="lastName">นามสกุล</label>
            <input type="text" name="lastName" id="lastName" class="form-control" required>

            <label for="tel">เบอร์โทร</label>
            <input type="text" name="tel" id="tel" class="form-control" required>
        </div>
    </div>

    <!-- ฟอร์ม Order -->
    <div id="orders">
        <div class="order">
            <label for="order_name">Order Name:</label>
            <input type="text" name="order_names" required>

            <label for="amount">Amount:</label>
            <input type="number" name="amounts" required>

            <label for="price">Price:</label>
            <input type="number" name="prices" required>

            <button type="button" class="btn btn-danger remove-order">ลบ</button>
        </div>
    </div>

    <!-- ปุ่มเพิ่ม Order -->
    <button type="button" id="add-order" class="btn btn-warning">เพิ่ม Order</button>
    <button type="submit" class="btn btn-success">สร้าง Orders</button>
</form>

<!-- Popup -->
{% if success %}
<div id="popup" style="display: block; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 999; background: white; padding: 20px; border-radius: 10px; box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1); width: 90%; max-width: 800px; height: 90%; max-height: 600px; overflow: hidden;">
    <h4 style="text-align: center;">สร้างใบเสนอราคาเสร็จสิ้น</h4>
    <iframe src="{{quotation_view_url}}" style="width: 100%; height: 80%; border: none;"></iframe>
    <br>
    <div style="display: flex; justify-content: space-between; align-items: flex-end;">
        <!-- รูปภาพลายเซ็น -->
        <img src="{% static 'signature.png' %}" alt="Signature" style="width: 150px; height: auto; margin-left: 10px;">
        <!-- ปุ่มปิด popup -->
        <button onclick="document.getElementById('popup').style.display='none'" class="btn btn-danger" style="margin: 10px;">ปิด</button>
    </div>
</div>
{% endif %}

<!-- ปุ่มย้อนกลับไปหน้า Orders -->
<a href="/adminmanage/manage/" class="btn btn-primary" style="position: fixed; bottom: 20px; right: 20px; z-index: 1000;">
    ย้อนกลับไปหน้า Orders
</a>

<script>
    // เพิ่มแถว Order
    document.getElementById("add-order").addEventListener("click", function () {
        const ordersContainer = document.getElementById("orders");
        const newOrderDiv = document.createElement('div');
        newOrderDiv.classList.add('order');
        newOrderDiv.innerHTML = `
            <label for="order_name">Order Name:</label>
            <input type="text" name="order_names" required>

            <label for="amount">Amount:</label>
            <input type="number" name="amounts" required>

            <label for="price">Price:</label>
            <input type="number" name="prices" required>

            <button type="button" class="btn btn-danger remove-order">ลบ</button>
        `;
        ordersContainer.appendChild(newOrderDiv);
    });

    // ลบแถว Order
    document.getElementById("orders").addEventListener("click", function (e) {
        if (e.target && e.target.classList.contains("remove-order")) {
            e.target.closest(".order").remove();
        }
    });
</script>
{% endblock %}